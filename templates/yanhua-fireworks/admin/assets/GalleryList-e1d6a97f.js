import{b as de,r as m,k as H,c as ue,x as ie,e as r,y as ce,o as v,f as U,h as l,w as a,g as d,q as T,i as u,z as me,F as pe,m as _e,p as ge,l as I,t as k,E as n,G as fe,B as ve,H as M,I as ye,A as be}from"./index-1dad1f50.js";import{s as x}from"./request-0b13b1fd.js";import{_ as Ve}from"./_plugin-vue_export-helper-c27b6911.js";function Ue(c){return x({url:"/admin/home-gallery/list",method:"get",params:c})}function ke(c){return x({url:"/admin/home-gallery/add",method:"post",data:c})}function N(c,i){return x({url:`/admin/home-gallery/update/${c}`,method:"put",data:i})}function we(c){return x({url:`/admin/home-gallery/delete/${c}`,method:"delete"})}const he={class:"gallery-list-container"},Te={class:"header-actions"},xe={class:"gallery-grid"},Ce={class:"image-wrapper"},Le={class:"image-error"},Be={class:"card-content"},Ge={class:"card-title"},Oe={class:"card-order"},ze={class:"card-actions"},$e={class:"upload-section"},Ee={key:0,class:"image-preview"},He={class:"image-error-small"},Ie=de({__name:"GalleryList",setup(c){const i=m("about"),w=m(!1),y=m([]),b=m(!1),R=H(()=>"https://fireworks-project.zhengpan.cn/api/upload/image"),S=H(()=>({Authorization:`Bearer ${localStorage.getItem("admin_token")}`})),g=m(!1),C=m("添加图片"),L=m(!1),B=m(),s=ue({moduleType:"about",imageUrl:"",title:"",description:"",sortOrder:0,status:1}),q={moduleType:[{required:!0,message:"请选择模块类型",trigger:"change"}],imageUrl:[{required:!0,message:"请上传图片或输入图片URL",trigger:"blur"}],sortOrder:[{required:!0,message:"请输入排序",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},A=t=>{const e=t.type.startsWith("image/"),p=t.size/1024/1024<10;return e?p?(b.value=!0,!0):(n.error("图片大小不能超过 10MB!"),!1):(n.error("只能上传图片文件!"),!1)},D=t=>{b.value=!1,t.code===200?(s.imageUrl=t.data.url,n.success("图片上传成功")):n.error(t.message||"上传失败")},j=t=>{b.value=!1,console.error("上传失败:",t),n.error("图片上传失败")},V=async()=>{w.value=!0;try{console.log("正在加载图片列表，模块类型:",i.value);const t=await Ue({moduleType:i.value});console.log("API响应:",t),console.log("响应数据:",t.data),t.data.code===200?(y.value=t.data.data||[],console.log("更新后的galleryList:",y.value),console.log("列表长度:",y.value.length)):(console.error("API返回错误:",t.data),n.error(t.data.message||"加载失败"))}catch(t){console.error("加载失败:",t),n.error("加载图片列表失败")}finally{w.value=!1}},F=t=>{var p;const e=t.paneName||((p=t.props)==null?void 0:p.name);console.log("Tab切换到:",e),i.value=e,fe(()=>{console.log("开始加载数据，当前activeTab:",i.value),V()})},P=()=>{C.value="添加图片",Object.assign(s,{id:void 0,moduleType:i.value,imageUrl:"",title:"",description:"",sortOrder:0,status:1}),g.value=!0},W=t=>{C.value="编辑图片",Object.assign(s,{...t}),g.value=!0},J=async t=>{try{const e=t.status===1?0:1;await N(t.id,{status:e}),n.success("状态更新成功"),V()}catch(e){console.error("更新失败:",e),n.error("状态更新失败")}},K=t=>{be.confirm("确定要删除这张图片吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await we(t.id),n.success("删除成功"),V()}catch(e){console.error("删除失败:",e),n.error("删除失败")}}).catch(()=>{})},Q=async()=>{B.value&&await B.value.validate(async t=>{if(t){L.value=!0;try{s.id?(await N(s.id,s),n.success("更新成功")):(await ke(s),n.success("添加成功")),g.value=!1,await V()}catch(e){console.error("提交失败:",e),n.error("操作失败")}finally{L.value=!1}}})};return ie(()=>{V()}),(t,e)=>{const p=r("el-tab-pane"),X=r("el-tabs"),h=r("el-icon"),_=r("el-button"),O=r("el-image"),Y=r("el-tag"),Z=r("el-empty"),ee=r("el-card"),z=r("el-option"),le=r("el-select"),f=r("el-form-item"),te=r("el-upload"),G=r("el-input"),ae=r("el-input-number"),$=r("el-radio"),oe=r("el-radio-group"),se=r("el-form"),re=r("el-dialog"),ne=ce("loading");return v(),U("div",he,[l(ee,null,{default:a(()=>[d("div",Te,[l(X,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=o=>i.value=o),onTabClick:F},{default:a(()=>[l(p,{label:"关于我们",name:"about"}),l(p,{label:"领导来访",name:"visit"})]),_:1},8,["modelValue"]),l(_,{type:"primary",onClick:P},{default:a(()=>[l(h,null,{default:a(()=>[l(T(ve))]),_:1}),e[9]||(e[9]=u(" 添加图片 ",-1))]),_:1})]),me((v(),U("div",xe,[(v(!0),U(pe,null,_e(y.value,o=>(v(),U("div",{key:o.id,class:"gallery-card"},[d("div",Ce,[l(O,{src:o.imageUrl,fit:"cover",class:"gallery-image"},{error:a(()=>[d("div",Le,[l(h,null,{default:a(()=>[l(T(M))]),_:1}),e[10]||(e[10]=d("span",null,"加载失败",-1))])]),_:1},8,["src"]),l(Y,{type:o.status===1?"success":"info",class:"status-tag"},{default:a(()=>[u(k(o.status===1?"显示":"隐藏"),1)]),_:2},1032,["type"])]),d("div",Be,[d("div",Ge,k(o.title||"无标题"),1),d("div",Oe,"排序: "+k(o.sortOrder),1)]),d("div",ze,[l(_,{size:"small",onClick:E=>W(o)},{default:a(()=>[...e[11]||(e[11]=[u("编辑",-1)])]),_:1},8,["onClick"]),l(_,{size:"small",type:o.status===1?"warning":"success",onClick:E=>J(o)},{default:a(()=>[u(k(o.status===1?"隐藏":"显示"),1)]),_:2},1032,["type","onClick"]),l(_,{size:"small",type:"danger",onClick:E=>K(o)},{default:a(()=>[...e[12]||(e[12]=[u(" 删除 ",-1)])]),_:1},8,["onClick"])])]))),128)),!w.value&&y.value.length===0?(v(),ge(Z,{key:0,description:"暂无图片"})):I("",!0)])),[[ne,w.value]])]),_:1}),l(re,{modelValue:g.value,"onUpdate:modelValue":e[8]||(e[8]=o=>g.value=o),title:C.value,width:"600px"},{footer:a(()=>[l(_,{onClick:e[7]||(e[7]=o=>g.value=!1)},{default:a(()=>[...e[18]||(e[18]=[u("取消",-1)])]),_:1}),l(_,{type:"primary",onClick:Q,loading:L.value},{default:a(()=>[...e[19]||(e[19]=[u(" 确定 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(se,{ref_key:"formRef",ref:B,model:s,rules:q,"label-width":"100px"},{default:a(()=>[l(f,{label:"模块类型",prop:"moduleType"},{default:a(()=>[l(le,{modelValue:s.moduleType,"onUpdate:modelValue":e[1]||(e[1]=o=>s.moduleType=o),placeholder:"请选择模块类型"},{default:a(()=>[l(z,{label:"关于我们",value:"about"}),l(z,{label:"领导来访",value:"visit"})]),_:1},8,["modelValue"])]),_:1}),l(f,{label:"图片",prop:"imageUrl"},{default:a(()=>[d("div",$e,[l(te,{class:"image-uploader",action:R.value,headers:S.value,"show-file-list":!1,"on-success":D,"on-error":j,"before-upload":A,accept:"image/*"},{default:a(()=>[l(_,{type:"primary",loading:b.value},{default:a(()=>[l(h,null,{default:a(()=>[l(T(ye))]),_:1}),u(" "+k(b.value?"上传中...":"选择图片上传"),1)]),_:1},8,["loading"])]),_:1},8,["action","headers"]),e[14]||(e[14]=d("div",{class:"upload-tip"},"支持 jpg、png、gif 格式，大小不超过10MB",-1)),s.imageUrl?(v(),U("div",Ee,[l(O,{src:s.imageUrl,fit:"contain",style:{width:"200px",height:"150px"}},{error:a(()=>[d("div",He,[l(h,null,{default:a(()=>[l(T(M))]),_:1})])]),_:1},8,["src"])])):I("",!0),l(G,{modelValue:s.imageUrl,"onUpdate:modelValue":e[2]||(e[2]=o=>s.imageUrl=o),placeholder:"或手动输入图片URL",style:{"margin-top":"10px"}},{prepend:a(()=>[...e[13]||(e[13]=[u("URL",-1)])]),_:1},8,["modelValue"])])]),_:1}),l(f,{label:"标题"},{default:a(()=>[l(G,{modelValue:s.title,"onUpdate:modelValue":e[3]||(e[3]=o=>s.title=o),placeholder:"请输入图片标题(可选)"},null,8,["modelValue"])]),_:1}),l(f,{label:"描述"},{default:a(()=>[l(G,{modelValue:s.description,"onUpdate:modelValue":e[4]||(e[4]=o=>s.description=o),type:"textarea",rows:3,placeholder:"请输入图片描述(可选)"},null,8,["modelValue"])]),_:1}),l(f,{label:"排序",prop:"sortOrder"},{default:a(()=>[l(ae,{modelValue:s.sortOrder,"onUpdate:modelValue":e[5]||(e[5]=o=>s.sortOrder=o),min:0,max:999},null,8,["modelValue"]),e[15]||(e[15]=d("div",{class:"form-tip"},"数字越小越靠前",-1))]),_:1}),l(f,{label:"状态",prop:"status"},{default:a(()=>[l(oe,{modelValue:s.status,"onUpdate:modelValue":e[6]||(e[6]=o=>s.status=o)},{default:a(()=>[l($,{label:1},{default:a(()=>[...e[16]||(e[16]=[u("显示",-1)])]),_:1}),l($,{label:0},{default:a(()=>[...e[17]||(e[17]=[u("隐藏",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});const Se=Ve(Ie,[["__scopeId","data-v-ceb8e64b"]]);export{Se as default};
