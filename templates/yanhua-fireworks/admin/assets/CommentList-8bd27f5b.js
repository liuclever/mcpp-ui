import{b as K,c as x,r as V,x as Q,e as n,y as X,o as v,f as Y,h as t,w as a,g as b,i as u,z as Z,p as C,t as j,l as S,u as ee,E as m,A as te}from"./index-1dad1f50.js";import{s as D}from"./request-0b13b1fd.js";import{_ as oe}from"./_plugin-vue_export-helper-c27b6911.js";function ae(y){const f=localStorage.getItem("admin_token");return console.log("ğŸ” getCommentList - Token:",f?`${f.substring(0,20)}...`:"NOT FOUND"),D({url:"/admin/comment/list",method:"get",params:y,headers:{Authorization:f?`Bearer ${f}`:""}})}function N(y){return D({url:"/admin/comment/review",method:"post",params:y})}function le(y){return D({url:`/admin/comment/delete/${y}`,method:"delete"})}const ne={class:"comment-list-container"},se={class:"user-info"},re={class:"user-name"},ie={class:"comment-content"},de=K({__name:"CommentList",setup(y){const f=ee(),r=x({status:null,videoId:""}),s=x({page:1,pageSize:10,total:0}),h=V([]),w=V(!1),k=V(!1),i=x({commentId:0,reason:""}),c=async()=>{var l;w.value=!0;try{if(!localStorage.getItem("admin_token")){m.error("ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•"),f.push("/login");return}const d={status:r.status===null?void 0:r.status,videoId:r.videoId||void 0,page:s.page,pageSize:s.pageSize};console.log("Request params:",d);const p=await ae(d);console.log("API Response:",p),console.log("res.data:",p.data),console.log("res.data.data:",p.data.data),console.log("res.data.data.records:",p.data.data.records),h.value=p.data.data.records||[],s.total=p.data.data.total||0,console.log("commentList.value:",h.value),console.log("commentList.value.length:",h.value.length)}catch(e){console.error("Load error:",e),((l=e.response)==null?void 0:l.status)===401?(m.error("ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•"),localStorage.removeItem("admin_token"),localStorage.removeItem("admin_info"),f.push("/login")):m.error("åŠ è½½è¯„è®ºåˆ—è¡¨å¤±è´¥")}finally{w.value=!1}},R=()=>{s.page=1,c()},T=()=>{r.status=null,r.videoId="",s.page=1,c()},L=async(l,e)=>{if(e===2)i.commentId=l.id,i.reason="",k.value=!0;else try{console.log("å¼€å§‹å®¡æ ¸è¯„è®º:",l.id,"çŠ¶æ€:",e);const d=await N({commentId:l.id,status:e});console.log("å®¡æ ¸å“åº”:",d),m.success("å®¡æ ¸æˆåŠŸ"),console.log("å¼€å§‹åˆ·æ–°åˆ—è¡¨..."),await c(),console.log("åˆ—è¡¨åˆ·æ–°å®Œæˆ")}catch(d){console.error("å®¡æ ¸å¤±è´¥:",d),m.error("å®¡æ ¸å¤±è´¥")}},A=async()=>{if(!i.reason.trim()){m.warning("è¯·è¾“å…¥æ‹’ç»åŸå› ");return}try{console.log("å¼€å§‹æ‹’ç»è¯„è®º:",i.commentId,"åŸå› :",i.reason);const l=await N({commentId:i.commentId,status:2,rejectReason:i.reason});console.log("æ‹’ç»å“åº”:",l),m.success("å®¡æ ¸æˆåŠŸ"),k.value=!1,console.log("å¼€å§‹åˆ·æ–°åˆ—è¡¨..."),await c(),console.log("åˆ—è¡¨åˆ·æ–°å®Œæˆ")}catch(l){console.error("æ‹’ç»å¤±è´¥:",l),m.error("å®¡æ ¸å¤±è´¥")}},E=async l=>{try{await te.confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡è¯„è®ºå—ï¼Ÿ","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),await le(l.id),m.success("åˆ é™¤æˆåŠŸ"),c()}catch(e){e!=="cancel"&&m.error("åˆ é™¤å¤±è´¥")}},F=()=>{s.page=1,c()},M=()=>{c()};Q(()=>{c()});const P=l=>l?l.startsWith("http://")||l.startsWith("https://")?l:l.startsWith("/")?`https://fireworks-project.zhengpan.cn${l}`:"/assets/images/default-avatar.png":"/assets/images/default-avatar.png";return(l,e)=>{const d=n("el-option"),p=n("el-select"),I=n("el-form-item"),U=n("el-input"),_=n("el-button"),B=n("el-form"),g=n("el-table-column"),W=n("el-avatar"),z=n("el-tag"),O=n("el-table"),q=n("el-pagination"),G=n("el-card"),H=n("el-dialog"),J=X("loading");return v(),Y("div",ne,[t(G,null,{header:a(()=>[...e[7]||(e[7]=[b("div",{class:"card-header"},[b("span",null,"UGCè¯„è®ºç®¡ç†")],-1)])]),default:a(()=>[t(B,{inline:!0,model:r,class:"search-form"},{default:a(()=>[t(I,{label:"å®¡æ ¸çŠ¶æ€"},{default:a(()=>[t(p,{modelValue:r.status,"onUpdate:modelValue":e[0]||(e[0]=o=>r.status=o),placeholder:"å…¨éƒ¨",clearable:"",style:{width:"150px"}},{default:a(()=>[t(d,{label:"å¾…å®¡æ ¸",value:0}),t(d,{label:"å·²é€šè¿‡",value:1}),t(d,{label:"æœªé€šè¿‡",value:2})]),_:1},8,["modelValue"])]),_:1}),t(I,{label:"è§†é¢‘ID"},{default:a(()=>[t(U,{modelValue:r.videoId,"onUpdate:modelValue":e[1]||(e[1]=o=>r.videoId=o),placeholder:"è¯·è¾“å…¥è§†é¢‘ID",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(I,null,{default:a(()=>[t(_,{type:"primary",onClick:R},{default:a(()=>[...e[8]||(e[8]=[u("æŸ¥è¯¢",-1)])]),_:1}),t(_,{onClick:T},{default:a(()=>[...e[9]||(e[9]=[u("é‡ç½®",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),Z((v(),C(O,{data:h.value,border:"",style:{width:"100%"}},{default:a(()=>[t(g,{prop:"id",label:"ID",width:"80"}),t(g,{prop:"videoId",label:"è§†é¢‘ID",width:"100"}),t(g,{label:"ç”¨æˆ·ä¿¡æ¯",width:"200"},{default:a(({row:o})=>[b("div",se,[t(W,{size:40,src:P(o.userAvatar)},null,8,["src"]),b("span",re,j(o.userName||"æœªçŸ¥ç”¨æˆ·"),1)])]),_:1}),t(g,{prop:"content",label:"è¯„è®ºå†…å®¹","min-width":"300"},{default:a(({row:o})=>[b("div",ie,j(o.content),1)]),_:1}),t(g,{prop:"likes",label:"ç‚¹èµæ•°",width:"100",align:"center"}),t(g,{label:"çŠ¶æ€",width:"100",align:"center"},{default:a(({row:o})=>[o.status===0?(v(),C(z,{key:0,type:"warning"},{default:a(()=>[...e[10]||(e[10]=[u("å¾…å®¡æ ¸",-1)])]),_:1})):o.status===1?(v(),C(z,{key:1,type:"success"},{default:a(()=>[...e[11]||(e[11]=[u("å·²é€šè¿‡",-1)])]),_:1})):o.status===2?(v(),C(z,{key:2,type:"danger"},{default:a(()=>[...e[12]||(e[12]=[u("æœªé€šè¿‡",-1)])]),_:1})):S("",!0)]),_:1}),t(g,{prop:"createTime",label:"å‘å¸ƒæ—¶é—´",width:"180"}),t(g,{label:"æ“ä½œ",width:"250",fixed:"right"},{default:a(({row:o})=>[o.status===0?(v(),C(_,{key:0,type:"success",size:"small",onClick:$=>L(o,1)},{default:a(()=>[...e[13]||(e[13]=[u(" é€šè¿‡ ",-1)])]),_:1},8,["onClick"])):S("",!0),o.status===0?(v(),C(_,{key:1,type:"warning",size:"small",onClick:$=>L(o,2)},{default:a(()=>[...e[14]||(e[14]=[u(" æ‹’ç» ",-1)])]),_:1},8,["onClick"])):S("",!0),t(_,{type:"danger",size:"small",onClick:$=>E(o)},{default:a(()=>[...e[15]||(e[15]=[u(" åˆ é™¤ ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[J,w.value]]),t(q,{"current-page":s.page,"onUpdate:currentPage":e[2]||(e[2]=o=>s.page=o),"page-size":s.pageSize,"onUpdate:pageSize":e[3]||(e[3]=o=>s.pageSize=o),"page-sizes":[10,20,50,100],total:s.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:F,onCurrentChange:M,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),t(H,{modelValue:k.value,"onUpdate:modelValue":e[6]||(e[6]=o=>k.value=o),title:"æ‹’ç»åŸå› ",width:"500px"},{footer:a(()=>[t(_,{onClick:e[5]||(e[5]=o=>k.value=!1)},{default:a(()=>[...e[16]||(e[16]=[u("å–æ¶ˆ",-1)])]),_:1}),t(_,{type:"primary",onClick:A},{default:a(()=>[...e[17]||(e[17]=[u("ç¡®å®š",-1)])]),_:1})]),default:a(()=>[t(B,{model:i},{default:a(()=>[t(I,{label:"æ‹’ç»åŸå› "},{default:a(()=>[t(U,{modelValue:i.reason,"onUpdate:modelValue":e[4]||(e[4]=o=>i.reason=o),type:"textarea",rows:4,placeholder:"è¯·è¾“å…¥æ‹’ç»åŸå› "},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});const pe=oe(de,[["__scopeId","data-v-9fe23729"]]);export{pe as default};
