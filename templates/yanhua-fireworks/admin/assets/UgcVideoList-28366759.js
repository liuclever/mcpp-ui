import{s as $}from"./request-0b13b1fd.js";import{b as le,r as k,x as te,e as i,y as ae,o as m,f as U,h as t,w as a,g as v,i as r,F as oe,m as ne,z as se,p as w,t as u,l as L,E as d,A as M}from"./index-1dad1f50.js";import{_ as ie}from"./_plugin-vue_export-helper-c27b6911.js";const re=_=>$.get("/video/list",{params:_}),de=_=>$.delete(`/video/delete/${_}`),ue=(_,h,g)=>{const y={status:h};return g&&(y.reason=g),$.post(`/video/audit/${_}`,null,{params:y})},pe=_=>$.post("/video/upload",_,{headers:{"Content-Type":"multipart/form-data"}}),ce={class:"page-container"},ve={class:"card-header"},fe={key:1,class:"no-cover"},me={class:"user-info"},_e={style:{"margin-left":"8px"}},ge={key:1,style:{color:"#999"}},ye={class:"stats"},be={class:"el-upload__tip"},ke=le({__name:"UgcVideoList",setup(_){const h=k(!1),g=k([]),y=k(0),p=k({status:void 0,page:1,pageSize:20}),C=k(!1),s=k({title:"",description:"",location:"",file:null}),x=k(!1),N=[{label:"å…¨éƒ¨",value:void 0},{label:"å¾…å®¡æ ¸",value:0},{label:"å·²é€šè¿‡",value:1},{label:"æœªé€šè¿‡",value:2}],b=async()=>{h.value=!0;try{const o=await re(p.value);console.log("UGCè§†é¢‘åˆ—è¡¨å®Œæ•´å“åº”:",o);const e=o.data.data;e&&e.records?(g.value=e.records,y.value=e.total||0,console.log("âœ… åŠ è½½UGCè§†é¢‘åˆ—è¡¨æˆåŠŸ:",e.records.length,"ä¸ªè§†é¢‘, æ€»æ•°:",e.total),e.records.length>0&&console.log("ç¬¬ä¸€æ¡è§†é¢‘æ•°æ®:",e.records[0])):(console.warn("âš ï¸ å“åº”æ•°æ®ç»“æ„å¼‚å¸¸:",o.data),g.value=[],y.value=0)}catch(o){console.error("âŒ åŠ è½½è§†é¢‘åˆ—è¡¨å¤±è´¥:",o),console.error("é”™è¯¯è¯¦æƒ…:",o.response),d.error(o.message||"åŠ è½½å¤±è´¥"),g.value=[],y.value=0}finally{h.value=!1}},P=()=>{p.value.page=1,b()},S=()=>{p.value={status:void 0,page:1,pageSize:20},b()},E=o=>{p.value.page=o,b()},q=o=>{M.confirm(`ç¡®å®šåˆ é™¤è§†é¢‘"${o.title||"æ— æ ‡é¢˜"}"å—ï¼Ÿ`,"æç¤º",{type:"warning"}).then(async()=>{try{const e=await de(o.id);e.data.code===200?(d.success("åˆ é™¤æˆåŠŸ"),b()):d.error(e.data.message||"åˆ é™¤å¤±è´¥")}catch(e){console.error("åˆ é™¤è§†é¢‘å¤±è´¥:",e),d.error("åˆ é™¤å¤±è´¥")}})},B=(o,e)=>{const n=e===1?"é€šè¿‡":"æ‹’ç»";M.confirm(`ç¡®å®š${n}è¯¥è§†é¢‘å—ï¼Ÿ`,"æç¤º",{type:"warning"}).then(async()=>{try{const f=await ue(o.id,e);f.data.code===200?(d.success(`${n}æˆåŠŸ`),b()):d.error(f.data.message||`${n}å¤±è´¥`)}catch(f){console.error("å®¡æ ¸è§†é¢‘å¤±è´¥:",f),d.error(`${n}å¤±è´¥`)}})},A=o=>{window.open(o.videoUrl,"_blank")},G=o=>({0:"å¾…å®¡æ ¸",1:"å·²é€šè¿‡",2:"æœªé€šè¿‡",3:"å·²åˆ é™¤"})[o]||"æœªçŸ¥",I=o=>o?o.replace("T"," ").substring(0,19):"-",R=o=>(s.value.file=o.raw,!1),j=async()=>{var o,e;if(!s.value.file){d.error("è¯·é€‰æ‹©è§†é¢‘æ–‡ä»¶");return}if(!s.value.title){d.error("è¯·è¾“å…¥è§†é¢‘æ ‡é¢˜");return}x.value=!0;try{const n=new FormData;n.append("file",s.value.file),n.append("title",s.value.title),s.value.description&&n.append("description",s.value.description),s.value.location&&n.append("location",s.value.location);const f=await pe(n);f.data.code===200?(d.success("ä¸Šä¼ æˆåŠŸ"),C.value=!1,s.value={title:"",description:"",location:"",file:null},b()):d.error(f.data.message||"ä¸Šä¼ å¤±è´¥")}catch(n){console.error("ä¸Šä¼ è§†é¢‘å¤±è´¥:",n),d.error(((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.message)||n.message||"ä¸Šä¼ å¤±è´¥")}finally{x.value=!1}},O=()=>{C.value=!1,s.value={title:"",description:"",location:"",file:null}};return te(()=>{b()}),(o,e)=>{const n=i("el-button"),f=i("el-option"),H=i("el-select"),V=i("el-form-item"),T=i("el-form"),c=i("el-table-column"),J=i("el-image"),K=i("el-avatar"),F=i("el-tag"),Q=i("el-table"),W=i("el-pagination"),X=i("el-card"),Y=i("el-upload"),D=i("el-input"),Z=i("el-dialog"),ee=ae("loading");return m(),U("div",ce,[t(X,{shadow:"never"},{header:a(()=>[v("div",ve,[e[8]||(e[8]=v("span",null,"UGCè§†é¢‘ç®¡ç†",-1)),t(n,{type:"primary",onClick:e[0]||(e[0]=l=>C.value=!0)},{default:a(()=>[...e[7]||(e[7]=[r("ä¸Šä¼ è§†é¢‘",-1)])]),_:1})])]),default:a(()=>[t(T,{model:p.value,inline:""},{default:a(()=>[t(V,{label:"çŠ¶æ€"},{default:a(()=>[t(H,{modelValue:p.value.status,"onUpdate:modelValue":e[1]||(e[1]=l=>p.value.status=l),placeholder:"è¯·é€‰æ‹©çŠ¶æ€",clearable:"",style:{width:"150px"}},{default:a(()=>[(m(),U(oe,null,ne(N,l=>t(f,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(V,null,{default:a(()=>[t(n,{type:"primary",onClick:P},{default:a(()=>[...e[9]||(e[9]=[r("æœç´¢",-1)])]),_:1}),t(n,{onClick:S},{default:a(()=>[...e[10]||(e[10]=[r("é‡ç½®",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),se((m(),w(Q,{data:g.value,stripe:""},{default:a(()=>[t(c,{prop:"id",label:"ID",width:"80"}),t(c,{label:"å°é¢",width:"120"},{default:a(({row:l})=>[l.coverUrl?(m(),w(J,{key:0,src:l.coverUrl,fit:"cover",style:{width:"100px",height:"60px","border-radius":"4px"},"preview-src-list":[l.coverUrl]},null,8,["src","preview-src-list"])):(m(),U("div",fe,"æ— å°é¢"))]),_:1}),t(c,{prop:"title",label:"æ ‡é¢˜","min-width":"150"},{default:a(({row:l})=>[r(u(l.title||"æ— æ ‡é¢˜"),1)]),_:1}),t(c,{label:"å‘å¸ƒè€…",width:"150"},{default:a(({row:l})=>[v("div",me,[t(K,{size:30,src:l.userAvatar},null,8,["src"]),v("span",_e,u(l.userName||"æœªçŸ¥ç”¨æˆ·"),1)])]),_:1}),t(c,{prop:"location",label:"ä½ç½®",width:"120"}),t(c,{prop:"topics",label:"è¯é¢˜",width:"150"},{default:a(({row:l})=>[l.topics?(m(),w(F,{key:0,type:"info",size:"small"},{default:a(()=>[r(u(l.topics),1)]),_:2},1024)):(m(),U("span",ge,"-"))]),_:1}),t(c,{label:"æ•°æ®",width:"200"},{default:a(({row:l})=>[v("div",ye,[v("span",null,"ğŸ‘ï¸ "+u(l.views),1),v("span",null,"â¤ï¸ "+u(l.likes),1),v("span",null,"â­ "+u(l.collects),1),v("span",null,"ğŸ’¬ "+u(l.comments),1)])]),_:1}),t(c,{prop:"status",label:"çŠ¶æ€",width:"100"},{default:a(({row:l})=>[t(F,{type:l.status===1?"success":l.status===0?"warning":"danger"},{default:a(()=>[r(u(G(l.status)),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"createTime",label:"å‘å¸ƒæ—¶é—´",width:"160"},{default:a(({row:l})=>[r(u(I(l.createTime)),1)]),_:1}),t(c,{label:"æ“ä½œ",width:"200",fixed:"right"},{default:a(({row:l})=>[t(n,{type:"primary",link:"",onClick:z=>A(l)},{default:a(()=>[...e[11]||(e[11]=[r("é¢„è§ˆ",-1)])]),_:1},8,["onClick"]),l.status===0?(m(),w(n,{key:0,type:"success",link:"",onClick:z=>B(l,1)},{default:a(()=>[...e[12]||(e[12]=[r(" é€šè¿‡ ",-1)])]),_:1},8,["onClick"])):L("",!0),l.status===0?(m(),w(n,{key:1,type:"warning",link:"",onClick:z=>B(l,2)},{default:a(()=>[...e[13]||(e[13]=[r(" æ‹’ç» ",-1)])]),_:1},8,["onClick"])):L("",!0),t(n,{type:"danger",link:"",onClick:z=>q(l)},{default:a(()=>[...e[14]||(e[14]=[r("åˆ é™¤",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,h.value]]),t(W,{"current-page":p.value.page,"onUpdate:currentPage":e[2]||(e[2]=l=>p.value.page=l),"page-size":p.value.pageSize,total:y.value,layout:"total, prev, pager, next",onCurrentChange:E,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),t(Z,{modelValue:C.value,"onUpdate:modelValue":e[6]||(e[6]=l=>C.value=l),title:"ä¸Šä¼ è§†é¢‘",width:"500px","close-on-click-modal":!1},{footer:a(()=>[t(n,{onClick:O},{default:a(()=>[...e[16]||(e[16]=[r("å–æ¶ˆ",-1)])]),_:1}),t(n,{type:"primary",loading:x.value,onClick:j},{default:a(()=>[r(u(x.value?"ä¸Šä¼ ä¸­...":"ç¡®å®šä¸Šä¼ "),1)]),_:1},8,["loading"])]),default:a(()=>[t(T,{model:s.value,"label-width":"80px"},{default:a(()=>[t(V,{label:"è§†é¢‘æ–‡ä»¶",required:""},{default:a(()=>[t(Y,{"auto-upload":!1,"on-change":R,limit:1,accept:"video/*","file-list":[]},{tip:a(()=>[v("div",be,u(s.value.file?`å·²é€‰æ‹©: ${s.value.file.name}`:"æ”¯æŒMP4æ ¼å¼ï¼Œæœ€å¤§100MB"),1)]),default:a(()=>[t(n,{type:"primary"},{default:a(()=>[...e[15]||(e[15]=[r("é€‰æ‹©è§†é¢‘",-1)])]),_:1})]),_:1})]),_:1}),t(V,{label:"è§†é¢‘æ ‡é¢˜",required:""},{default:a(()=>[t(D,{modelValue:s.value.title,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.title=l),placeholder:"è¯·è¾“å…¥è§†é¢‘æ ‡é¢˜"},null,8,["modelValue"])]),_:1}),t(V,{label:"è§†é¢‘æè¿°"},{default:a(()=>[t(D,{modelValue:s.value.description,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.description=l),type:"textarea",rows:3,placeholder:"è¯·è¾“å…¥è§†é¢‘æè¿°"},null,8,["modelValue"])]),_:1}),t(V,{label:"æ‹æ‘„ä½ç½®"},{default:a(()=>[t(D,{modelValue:s.value.location,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.location=l),placeholder:"è¯·è¾“å…¥æ‹æ‘„ä½ç½®"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});const we=ie(ke,[["__scopeId","data-v-0a4bf919"]]);export{we as default};
