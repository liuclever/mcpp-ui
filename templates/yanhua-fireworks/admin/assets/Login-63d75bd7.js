import{d as k,r as f,a as h,b as I,c as b,e as d,o as x,f as V,g as c,h as r,w as i,i as L,j as N,u as A,E as C}from"./index-1dad1f50.js";import{_ as O}from"./logo-67932c20.js";import{s as _}from"./request-0b13b1fd.js";import{_ as R}from"./_plugin-vue_export-helper-c27b6911.js";function z(l){return _({url:"/admin/login",method:"post",data:l})}function B(){return _({url:"/admin/info",method:"get"})}function E(){return _({url:"/admin/logout",method:"post"})}const J=k("admin",()=>{const l=f(localStorage.getItem("admin_token")||""),t=f(null);return{token:l,adminInfo:t,login:async n=>{const s=await z(n),e=s.data.data;return l.value=e.token,t.value={id:e.id,username:e.username,nickname:e.nickname,role:e.role,status:1,createTime:new Date().toISOString()},localStorage.setItem("admin_token",e.token),localStorage.setItem("admin_info",JSON.stringify(t.value)),console.log("✅ 登录成功，token已保存:",e.token.substring(0,20)+"..."),s},fetchAdminInfo:async()=>{const n=await B();return t.value=n.data.data,localStorage.setItem("admin_info",JSON.stringify(t.value)),n},logout:async()=>{try{await E()}finally{l.value="",t.value=null,localStorage.removeItem("admin_token"),localStorage.removeItem("admin_info"),h.push("/login")}},restoreState:()=>{const n=localStorage.getItem("admin_info");if(n)try{t.value=JSON.parse(n)}catch(s){console.error("恢复管理员信息失败",s)}}}}),U={class:"login-container"},q={class:"login-box"},K=I({__name:"Login",setup(l){const t=A(),v=J(),u=f(),m=f(!1),a=b({username:"",password:""}),n={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},s=async()=>{u.value&&await u.value.validate(async e=>{if(e){m.value=!0;try{await v.login({username:a.username,password:a.password}),C.success("登录成功"),t.push("/dashboard")}catch(o){console.error("登录失败：",o)}finally{m.value=!1}}})};return(e,o)=>{const y=d("el-input"),g=d("el-form-item"),w=d("el-button"),S=d("el-form");return x(),V("div",U,[c("div",q,[o[3]||(o[3]=c("div",{class:"login-header"},[c("img",{src:O,alt:"logo",class:"logo"}),c("h1",{class:"title"},"正攀烟花管理系统")],-1)),r(S,{ref_key:"formRef",ref:u,model:a,rules:n,class:"login-form",onKeyup:N(s,["enter"])},{default:i(()=>[r(g,{prop:"username"},{default:i(()=>[r(y,{modelValue:a.username,"onUpdate:modelValue":o[0]||(o[0]=p=>a.username=p),placeholder:"请输入用户名","prefix-icon":"User",size:"large"},null,8,["modelValue"])]),_:1}),r(g,{prop:"password"},{default:i(()=>[r(y,{modelValue:a.password,"onUpdate:modelValue":o[1]||(o[1]=p=>a.password=p),type:"password",placeholder:"请输入密码","prefix-icon":"Lock",size:"large","show-password":""},null,8,["modelValue"])]),_:1}),r(g,null,{default:i(()=>[r(w,{type:"primary",size:"large",loading:m.value,class:"login-btn",onClick:s},{default:i(()=>[...o[2]||(o[2]=[L(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])])}}});const F=R(K,[["__scopeId","data-v-164c2772"]]);export{F as default};
