import{b as ue,r as m,k as D,c as ce,x as pe,e as r,y as me,o as y,f as $,h as t,w as a,g as p,q as h,i as u,z as fe,p as M,t as L,l as E,E as n,A as I,B as _e,H as R,I as ve}from"./index-1dad1f50.js";import{s as V}from"./request-0b13b1fd.js";import{_ as ge}from"./_plugin-vue_export-helper-c27b6911.js";function ye(){return V({url:"/admin/activity/list",method:"get"})}function be(f){return V({url:"/admin/activity/add",method:"post",data:f})}function O(f,_){return V({url:`/admin/activity/update/${f}`,method:"put",data:_})}function we(f){return V({url:`/admin/activity/delete/${f}`,method:"delete"})}const Be={class:"activity-list-container"},he={class:"header-actions"},Ve={class:"image-error-small"},xe={key:1,style:{color:"#909399"}},Ue={class:"upload-section"},ke={key:0,class:"image-preview"},Ce={class:"image-error-small"},Te=ue({__name:"ActivityList",setup(f){const _=m(!1),x=m([]),b=m(!1),j=D(()=>"https://fireworks-project.zhengpan.cn/api/upload/image"),q=D(()=>({Authorization:`Bearer ${localStorage.getItem("admin_token")}`})),v=m(!1),U=m("添加话题"),k=m(!1),C=m(),s=ce({name:"",description:"",coverUrl:"",sortOrder:0,status:1,isBanner:0}),N={name:[{required:!0,message:"请输入话题名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],sortOrder:[{required:!0,message:"请输入排序",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},H=l=>({0:"草稿",1:"已上线",2:"已下线"})[l]||"未知",W=l=>({0:"info",1:"success",2:"warning"})[l]||"info",F=l=>{const e=l.type.startsWith("image/"),i=l.size/1024/1024<10;return e?i?(b.value=!0,!0):(n.error("图片大小不能超过 10MB!"),!1):(n.error("只能上传图片文件!"),!1)},G=l=>{b.value=!1,l.code===200?(s.coverUrl=l.data.url,n.success("封面上传成功")):n.error(l.message||"上传失败")},J=l=>{b.value=!1,console.error("上传失败:",l),n.error("封面上传失败")},w=async()=>{_.value=!0;try{const e=(await ye()).data;e.code===200?x.value=e.data||[]:n.error(e.message||"加载失败")}catch(l){console.error("加载失败:",l),n.error("加载话题列表失败")}finally{_.value=!1}},K=()=>{U.value="添加话题",Object.assign(s,{id:void 0,name:"",description:"",coverUrl:"",sortOrder:0,status:1,isBanner:0}),v.value=!0},P=l=>{U.value="编辑话题",Object.assign(s,{...l}),v.value=!0},Q=async l=>{try{const e=l.status===1?2:1,i=e===1?"上线":"下线";await I.confirm(`确定要${i}这个话题吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const d=(await O(l.id,{...l,status:e})).data;d.code===200?(n.success(`${i}成功`),w()):n.error(d.message||"状态更新失败")}catch(e){e!=="cancel"&&(console.error("更新失败:",e),n.error("状态更新失败"))}},X=async l=>{try{const e=l.isBanner===1?"设置为Banner":"取消Banner",c=(await O(l.id,{...l})).data;c.code===200?(n.success(`${e}成功`),w()):(n.error(c.message||"Banner状态更新失败"),l.isBanner=l.isBanner===1?0:1)}catch(e){console.error("更新失败:",e),n.error("Banner状态更新失败"),l.isBanner=l.isBanner===1?0:1}},Y=l=>{I.confirm("确定要删除这个话题吗? 删除后将同时删除相关的视频关联记录。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const i=(await we(l.id)).data;i.code===200?(n.success("删除成功"),w()):n.error(i.message||"删除失败")}catch(e){console.error("删除失败:",e),n.error("删除失败")}}).catch(()=>{})},Z=async()=>{C.value&&await C.value.validate(async l=>{if(l){k.value=!0;try{let e;s.id?e=await O(s.id,s):e=await be(s);const i=e.data;i.code===200?(n.success(s.id?"更新成功":"添加成功"),v.value=!1,w()):n.error(i.message||"操作失败")}catch(e){console.error("提交失败:",e),n.error("操作失败")}finally{k.value=!1}}})};return pe(()=>{w()}),(l,e)=>{const i=r("el-icon"),c=r("el-button"),d=r("el-table-column"),S=r("el-image"),ee=r("el-tag"),z=r("el-switch"),te=r("el-table"),le=r("el-empty"),ae=r("el-card"),T=r("el-input"),g=r("el-form-item"),oe=r("el-upload"),se=r("el-input-number"),A=r("el-radio"),ne=r("el-radio-group"),re=r("el-form"),ie=r("el-dialog"),de=me("loading");return y(),$("div",Be,[t(ae,null,{default:a(()=>[p("div",he,[e[9]||(e[9]=p("h2",null,"活动话题管理",-1)),t(c,{type:"primary",onClick:K},{default:a(()=>[t(i,null,{default:a(()=>[t(h(_e))]),_:1}),e[8]||(e[8]=u(" 添加话题 ",-1))]),_:1})]),fe((y(),M(te,{data:x.value,style:{width:"100%"}},{default:a(()=>[t(d,{prop:"id",label:"ID",width:"80"}),t(d,{prop:"name",label:"话题名称","min-width":"150"}),t(d,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),t(d,{label:"封面图",width:"120"},{default:a(({row:o})=>[o.coverUrl?(y(),M(S,{key:0,src:o.coverUrl,fit:"cover",style:{width:"80px",height:"60px","border-radius":"4px"}},{error:a(()=>[p("div",Ve,[t(i,null,{default:a(()=>[t(h(R))]),_:1})])]),_:1},8,["src"])):(y(),$("span",xe,"无封面"))]),_:1}),t(d,{label:"状态",width:"100"},{default:a(({row:o})=>[t(ee,{type:W(o.status)},{default:a(()=>[u(L(H(o.status)),1)]),_:2},1032,["type"])]),_:1}),t(d,{label:"是否Banner",width:"120"},{default:a(({row:o})=>[t(z,{modelValue:o.isBanner,"onUpdate:modelValue":B=>o.isBanner=B,"active-value":1,"inactive-value":0,onChange:B=>X(o)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(d,{prop:"sortOrder",label:"排序",width:"100"}),t(d,{prop:"createTime",label:"创建时间",width:"180"}),t(d,{label:"操作",width:"280",fixed:"right"},{default:a(({row:o})=>[t(c,{size:"small",onClick:B=>P(o)},{default:a(()=>[...e[10]||(e[10]=[u("编辑",-1)])]),_:1},8,["onClick"]),t(c,{size:"small",type:o.status===1?"warning":"success",onClick:B=>Q(o)},{default:a(()=>[u(L(o.status===1?"下线":"上线"),1)]),_:2},1032,["type","onClick"]),t(c,{size:"small",type:"danger",onClick:B=>Y(o)},{default:a(()=>[...e[11]||(e[11]=[u(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[de,_.value]]),!_.value&&x.value.length===0?(y(),M(le,{key:0,description:"暂无话题"})):E("",!0)]),_:1}),t(ie,{modelValue:v.value,"onUpdate:modelValue":e[7]||(e[7]=o=>v.value=o),title:U.value,width:"600px"},{footer:a(()=>[t(c,{onClick:e[6]||(e[6]=o=>v.value=!1)},{default:a(()=>[...e[19]||(e[19]=[u("取消",-1)])]),_:1}),t(c,{type:"primary",onClick:Z,loading:k.value},{default:a(()=>[...e[20]||(e[20]=[u(" 确定 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(re,{ref_key:"formRef",ref:C,model:s,rules:N,"label-width":"100px"},{default:a(()=>[t(g,{label:"话题名称",prop:"name"},{default:a(()=>[t(T,{modelValue:s.name,"onUpdate:modelValue":e[0]||(e[0]=o=>s.name=o),placeholder:"请输入话题名称，如：#春节烟花",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(g,{label:"描述"},{default:a(()=>[t(T,{modelValue:s.description,"onUpdate:modelValue":e[1]||(e[1]=o=>s.description=o),type:"textarea",rows:3,placeholder:"请输入话题描述(可选)",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(g,{label:"封面图"},{default:a(()=>[p("div",Ue,[t(oe,{class:"image-uploader",action:j.value,headers:q.value,"show-file-list":!1,"on-success":G,"on-error":J,"before-upload":F,accept:"image/*"},{default:a(()=>[t(c,{type:"primary",loading:b.value},{default:a(()=>[t(i,null,{default:a(()=>[t(h(ve))]),_:1}),u(" "+L(b.value?"上传中...":"选择封面上传"),1)]),_:1},8,["loading"])]),_:1},8,["action","headers"]),e[13]||(e[13]=p("div",{class:"upload-tip"},"支持 jpg、png、gif 格式，大小不超过10MB",-1)),s.coverUrl?(y(),$("div",ke,[t(S,{src:s.coverUrl,fit:"contain",style:{width:"200px",height:"150px"}},{error:a(()=>[p("div",Ce,[t(i,null,{default:a(()=>[t(h(R))]),_:1})])]),_:1},8,["src"])])):E("",!0),t(T,{modelValue:s.coverUrl,"onUpdate:modelValue":e[2]||(e[2]=o=>s.coverUrl=o),placeholder:"或手动输入封面URL(可选)",style:{"margin-top":"10px"}},{prepend:a(()=>[...e[12]||(e[12]=[u("URL",-1)])]),_:1},8,["modelValue"])])]),_:1}),t(g,{label:"排序",prop:"sortOrder"},{default:a(()=>[t(se,{modelValue:s.sortOrder,"onUpdate:modelValue":e[3]||(e[3]=o=>s.sortOrder=o),min:0,max:999},null,8,["modelValue"]),e[14]||(e[14]=p("div",{class:"form-tip"},"数字越小越靠前",-1))]),_:1}),t(g,{label:"状态",prop:"status"},{default:a(()=>[t(ne,{modelValue:s.status,"onUpdate:modelValue":e[4]||(e[4]=o=>s.status=o)},{default:a(()=>[t(A,{label:0},{default:a(()=>[...e[15]||(e[15]=[u("草稿",-1)])]),_:1}),t(A,{label:1},{default:a(()=>[...e[16]||(e[16]=[u("已上线",-1)])]),_:1}),t(A,{label:2},{default:a(()=>[...e[17]||(e[17]=[u("已下线",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(g,{label:"是否Banner"},{default:a(()=>[t(z,{modelValue:s.isBanner,"onUpdate:modelValue":e[5]||(e[5]=o=>s.isBanner=o),"active-value":1,"inactive-value":0},null,8,["modelValue"]),e[18]||(e[18]=p("div",{class:"form-tip"},"设置为Banner后，将在小程序社区页面顶部展示",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});const Le=ge(Te,[["__scopeId","data-v-06c14e93"]]);export{Le as default};
