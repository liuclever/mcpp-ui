import{a as j,e as G,f as U,h as H}from"./product-1c9747b1.js";import{b as J,r as _,k as K,x as O,e as s,y as P,o as p,f as g,h as l,w as n,g as y,i as u,z as Q,p as B,t as W,F as X,m as Y,E as d,A as Z}from"./index-1dad1f50.js";import{_ as ee}from"./_plugin-vue_export-helper-c27b6911.js";import"./request-0b13b1fd.js";const le={class:"page-container"},ae={class:"card-header"},te={key:0,class:"icon-preview"},oe=["src"],ne={style:{"margin-left":"8px"}},se={key:1,style:{color:"#999"}},de=J({__name:"CategoryList",setup(re){const b=_(!1),v=_([]),C=_([]),c=_(!1),I=K(()=>o.value.id?"编辑分类":"新增分类"),o=_({id:void 0,parentId:0,name:"",code:"",icon:"",sort:0,status:1}),h=async()=>{b.value=!0;try{const t=await j();if(t.data.code===200){const e=t.data.data||[];v.value=e.filter(r=>!r.parentId||r.parentId===0),C.value=v.value,console.log("分类树结构:",v.value)}else d.error(t.data.message||"获取分类列表失败")}catch(t){console.error("加载分类失败",t),d.error(t.message||"获取分类列表失败")}finally{b.value=!1}},L=()=>{o.value={id:void 0,parentId:0,name:"",code:"",icon:"",sort:0,status:1},c.value=!0},D=t=>{o.value={...t},c.value=!0},E=async t=>{try{const e=t.children&&t.children.length>0;let r="确定删除该分类吗？";e&&(r=`该分类下还有 ${t.children.length} 个子分类，删除后将全部删除，是否确定？`),await Z.confirm(r,"警告",{type:"warning",confirmButtonText:"确定删除",cancelButtonText:"取消"});const i=await G(t.id);i.data.code===200?(d.success(i.data.message||"删除成功"),h()):d.error(i.data.message||"删除失败")}catch(e){e!=="cancel"&&(console.error("删除失败",e),d.error(e.message||"删除失败"))}},$=async t=>{try{const e=await U(t);e.data.code===200?d.success("状态更新成功"):(d.error(e.data.message||"状态更新失败"),t.status=t.status===1?0:1)}catch(e){console.error("状态更新失败",e),d.error(e.message||"状态更新失败"),t.status=t.status===1?0:1}},M=async()=>{if(!o.value.name||!o.value.name.trim()){d.error("分类名称不能为空");return}if(!o.value.code||!o.value.code.trim()){d.error("分类代码不能为空");return}try{let t;o.value.id?t=await U(o.value):t=await H(o.value),t.data.code===200?(d.success(o.value.id?"更新成功":"添加成功"),c.value=!1,h()):d.error(t.data.message||"操作失败")}catch(t){console.error("保存失败",t),d.error(t.message||"操作失败")}};return O(()=>{h()}),(t,e)=>{const r=s("el-button"),i=s("el-table-column"),k=s("el-switch"),T=s("el-table"),z=s("el-card"),x=s("el-option"),N=s("el-select"),m=s("el-form-item"),V=s("el-input"),S=s("el-input-number"),w=s("el-radio"),q=s("el-radio-group"),A=s("el-form"),F=s("el-dialog"),R=P("loading");return p(),g("div",le,[l(z,{shadow:"never"},{header:n(()=>[y("div",ae,[e[9]||(e[9]=y("span",null,"分类管理",-1)),l(r,{type:"primary",onClick:L},{default:n(()=>[...e[8]||(e[8]=[u("新增分类",-1)])]),_:1})])]),default:n(()=>[Q((p(),B(T,{data:v.value,stripe:"","row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"},"default-expand-all":""},{default:n(()=>[l(i,{prop:"name",label:"分类名称","min-width":"200"}),l(i,{prop:"code",label:"分类代码",width:"150"}),l(i,{prop:"icon",label:"图标",width:"200"},{default:n(({row:a})=>[a.icon?(p(),g("span",te,[y("img",{src:a.icon,alt:"icon",style:{width:"24px",height:"24px","vertical-align":"middle"}},null,8,oe),y("span",ne,W(a.icon),1)])):(p(),g("span",se,"-"))]),_:1}),l(i,{prop:"sort",label:"排序",width:"100",align:"center"}),l(i,{prop:"status",label:"状态",width:"100",align:"center"},{default:n(({row:a})=>[l(k,{modelValue:a.status,"onUpdate:modelValue":f=>a.status=f,"active-value":1,"inactive-value":0,onChange:f=>$(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(i,{label:"操作",width:"180",align:"center",fixed:"right"},{default:n(({row:a})=>[l(r,{type:"primary",link:"",size:"small",onClick:f=>D(a)},{default:n(()=>[...e[10]||(e[10]=[u("编辑",-1)])]),_:1},8,["onClick"]),l(r,{type:"danger",link:"",size:"small",onClick:f=>E(a)},{default:n(()=>[...e[11]||(e[11]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[R,b.value]])]),_:1}),l(F,{modelValue:c.value,"onUpdate:modelValue":e[7]||(e[7]=a=>c.value=a),title:I.value,width:"500px"},{footer:n(()=>[l(r,{onClick:e[6]||(e[6]=a=>c.value=!1)},{default:n(()=>[...e[14]||(e[14]=[u("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:M},{default:n(()=>[...e[15]||(e[15]=[u("确定",-1)])]),_:1})]),default:n(()=>[l(A,{model:o.value,"label-width":"100px"},{default:n(()=>[l(m,{label:"父级分类"},{default:n(()=>[l(N,{modelValue:o.value.parentId,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.parentId=a),placeholder:"请选择(留空为父分类)",clearable:"",style:{width:"100%"}},{default:n(()=>[l(x,{label:"无(作为父分类)",value:0}),(p(!0),g(X,null,Y(C.value,a=>(p(),B(x,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"分类名称",required:""},{default:n(()=>[l(V,{modelValue:o.value.name,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.name=a),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),l(m,{label:"分类代码",required:""},{default:n(()=>[l(V,{modelValue:o.value.code,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.code=a),placeholder:"请输入分类代码"},null,8,["modelValue"])]),_:1}),l(m,{label:"图标URL"},{default:n(()=>[l(V,{modelValue:o.value.icon,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.icon=a),placeholder:"请输入图标URL"},null,8,["modelValue"])]),_:1}),l(m,{label:"排序"},{default:n(()=>[l(S,{modelValue:o.value.sort,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.sort=a),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(m,{label:"状态"},{default:n(()=>[l(q,{modelValue:o.value.status,"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.status=a)},{default:n(()=>[l(w,{label:1},{default:n(()=>[...e[12]||(e[12]=[u("启用",-1)])]),_:1}),l(w,{label:0},{default:n(()=>[...e[13]||(e[13]=[u("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});const pe=ee(de,[["__scopeId","data-v-82e4855c"]]);export{pe as default};
