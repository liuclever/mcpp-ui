# 社区首页实现说明

## 概述

社区首页是UGC视频内容的主要展示页面，支持图墙模式和信息流模式两种浏览方式。

## 已实现功能

### 1. 页面结构 (8.1)
- ✅ 创建了 `pages/community/index` 目录及所有必需文件
- ✅ 实现了页面布局（模式切换、视频列表）
- ✅ 添加到 `app.json` 的 pages 配置
- ✅ 添加到 tabBar 配置（位于"产品"和"专卖连锁"之间）

### 2. 图墙模式 (8.2)
- ✅ 实现双列瀑布流布局
- ✅ 使用 video-card 组件展示视频
- ✅ 实现点击进入详情功能
- ✅ 显示视频封面、标题、点赞数

### 3. 视频列表加载 (8.3)
- ✅ onLoad 加载初始数据
- ✅ 下拉刷新（onPullDownRefresh）
- ✅ 上拉加载更多（onReachBottom）
- ✅ 加载状态显示（loading spinner）
- ✅ 空状态显示（无视频时的提示）

### 4. 模式切换 (8.4)
- ✅ 添加模式切换按钮（图墙/信息流）
- ✅ 实现图墙/信息流模式切换
- ✅ 保存用户偏好到 storage

## 文件结构

```
pages/community/index/
├── index.ts       # 页面逻辑
├── index.wxml     # 页面结构
├── index.wxss     # 页面样式
└── index.json     # 页面配置
```

## 核心功能

### 数据加载
```typescript
loadVideoList(refresh: boolean)
```
- 支持刷新和分页加载
- 只显示审核通过的视频（status=1）
- 自动处理加载状态和错误

### 模式切换
```typescript
onModeChange(e: any)
```
- 图墙模式：在当前页面显示
- 信息流模式：跳转到 `/pages/community/feed` 页面
- 自动保存用户偏好

### 视频交互
```typescript
onVideoTap(e: any)
```
- 点击视频卡片跳转到详情页
- 传递视频ID参数

## 样式特点

1. **顶部工具栏**
   - 固定在顶部（sticky）
   - 包含模式切换和发布按钮
   - 使用品牌色 #d03a6a

2. **图墙布局**
   - 双列瀑布流
   - 20rpx 间距
   - 响应式卡片高度

3. **加载状态**
   - 旋转动画的 loading spinner
   - 友好的空状态提示
   - "没有更多"提示

## 依赖组件

- `video-card`: 视频卡片组件（支持 grid 和 list 模式）

## API 接口

使用 `utils/video-api.ts` 中的：
- `getVideoList()`: 获取视频列表

## 配置说明

### app.json 更新
1. 添加了 `pages/community/index` 到 pages 数组
2. 在 tabBar 中添加了"社区"标签（使用视频点赞图标）
3. tabBar 保持在 5 个项目（移除了"关于"标签以符合微信限制）

### 页面配置 (index.json)
- 启用下拉刷新：`enablePullDownRefresh: true`
- 深色加载样式：`backgroundTextStyle: "dark"`
- 注册 video-card 组件

## 用户体验

1. **首次加载**
   - 自动加载第一页数据
   - 显示 loading 状态

2. **刷新操作**
   - 下拉触发刷新
   - 重新加载第一页
   - 自动停止刷新动画

3. **加载更多**
   - 滚动到底部自动加载
   - 显示加载状态
   - 没有更多时显示提示

4. **空状态**
   - 友好的空状态图标和文案
   - 提供"发布第一个视频"按钮

## 待实现功能

以下功能需要在后续任务中实现：
- [ ] 信息流页面 (task 9)
- [ ] 视频详情页 (task 10)
- [ ] 视频发布页 (task 11)

## 注意事项

1. **tabBar 限制**：微信小程序 tabBar 只支持 2-5 个项目，当前配置为 5 个
2. **图标资源**：使用了现有的图标资源（视频点赞图标）
3. **页面跳转**：信息流模式会跳转到独立页面，需要在 task 9 中实现
4. **发布功能**：发布按钮会跳转到发布页面，需要在 task 11 中实现

## 测试建议

1. 测试下拉刷新功能
2. 测试上拉加载更多
3. 测试模式切换按钮
4. 测试空状态显示
5. 测试视频卡片点击跳转
6. 测试 tabBar 导航
