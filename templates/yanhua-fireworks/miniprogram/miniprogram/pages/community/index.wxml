<!--pages/community/index.wxml-->
<view class="community-page">
  <!-- é¡¶å›¾æ¨ªå¹… -->
  <page-banner pageKey="community" position="top"></page-banner>
  <!-- Bannerå¡ç‰‡ - å§‹ç»ˆæ˜¾ç¤ºä¸¤ä¸ª -->
  <view class="banner-cards">
    <!-- ç¬¬ä¸€ä¸ªBannerå¡ç‰‡ -->
    <view class="banner-card card-gradient-1" bindtap="onActivityTap" data-name="{{activities[0] ? activities[0].name : ''}}">
      <text class="banner-card-title">{{activities[0] ? activities[0].name : 'XXXæ´»åŠ¨æŒ‘æˆ˜èµ›'}}</text>
    </view>
    <!-- ç¬¬äºŒä¸ªBannerå¡ç‰‡ -->
    <view class="banner-card card-gradient-2" bindtap="onActivityTap" data-name="{{activities[1] ? activities[1].name : ''}}">
      <text class="banner-card-title">{{activities[1] ? activities[1].name : 'å®å®çš„ç¬¬ä¸€æ¬¡å‘çƒŸèŠ±'}}</text>
    </view>
  </view>

  <!-- æ’åºå’Œå¸ƒå±€åˆ‡æ¢æ  -->
  <view class="toolbar" wx:if="{{!isEmpty}}">
    <view class="sort-tabs">
      <view class="sort-tab {{sortType === 'views' ? 'active' : ''}}" bindtap="onSortChange" data-type="views">
        <text>æ’­æ”¾æ•°</text>
        <text class="sort-arrow">{{sortType === 'views' ? (sortOrder === 'desc' ? 'â–¼' : 'â–²') : 'â–½'}}</text>
      </view>
      <view class="sort-tab {{sortType === 'comments' ? 'active' : ''}}" bindtap="onSortChange" data-type="comments">
        <text>è¯„è®ºæ•°</text>
        <text class="sort-arrow">{{sortType === 'comments' ? (sortOrder === 'desc' ? 'â–¼' : 'â–²') : 'â–½'}}</text>
      </view>
      <view class="sort-tab {{sortType === 'collects' ? 'active' : ''}}" bindtap="onSortChange" data-type="collects">
        <text>æ”¶è—æ•°</text>
        <text class="sort-arrow">{{sortType === 'collects' ? (sortOrder === 'desc' ? 'â–¼' : 'â–²') : 'â–½'}}</text>
      </view>
    </view>
    <view class="layout-switch" bindtap="toggleLayout">
      <text class="layout-icon">{{layoutMode === 'double' ? 'â˜°' : 'â–¦'}}</text>
    </view>
  </view>

  <!-- åŒåˆ—å¸ƒå±€ -->
  <view class="video-grid" wx:if="{{!isEmpty && layoutMode === 'double'}}">
    <view class="grid-column">
      <block wx:for="{{videos}}" wx:key="id" wx:if="{{index % 2 === 0}}">
        <view class="video-item" bindtap="onVideoTap" data-index="{{index}}">
          <!-- è§†é¢‘å°é¢ -->
          <image class="video-cover" src="{{item.coverUrl}}" mode="aspectFill" />
          
          <!-- è§†é¢‘ä¿¡æ¯ -->
          <view class="video-info">
            <!-- è¯é¢˜æ ‡ç­¾ + æ ‡é¢˜ -->
            <text class="video-hashtag">{{item.topics || ''}} {{item.title}}</text>
            
            <!-- ç”¨æˆ·ä¿¡æ¯ -->
            <view class="video-footer">
              <view class="user-info">
                <image class="user-avatar-small" src="{{item.userAvatar || '/assets/icons/default-avatar.png'}}" mode="aspectFill" />
                <text class="user-name-small">{{item.userName || 'ç”¨æˆ·å'}}</text>
              </view>
            </view>
            
            <!-- äº’åŠ¨ä¿¡æ¯ -->
            <view class="interaction-info">
              <text class="interaction-item">ç‚¹èµ{{item.likes}}</text>
              <text class="interaction-item">è¯„è®º{{item.comments}}</text>
              <text class="interaction-item">æ”¶è—{{item.collects}}</text>
            </view>
          </view>
        </view>
      </block>
    </view>
    <view class="grid-column">
      <block wx:for="{{videos}}" wx:key="id" wx:if="{{index % 2 === 1}}">
        <view class="video-item" bindtap="onVideoTap" data-index="{{index}}">
          <!-- è§†é¢‘å°é¢ -->
          <image class="video-cover" src="{{item.coverUrl}}" mode="aspectFill" />
          
          <!-- è§†é¢‘ä¿¡æ¯ -->
          <view class="video-info">
            <!-- è¯é¢˜æ ‡ç­¾ + æ ‡é¢˜ -->
            <text class="video-hashtag">{{item.topics || ''}} {{item.title}}</text>
            
            <!-- ç”¨æˆ·ä¿¡æ¯ -->
            <view class="video-footer">
              <view class="user-info">
                <image class="user-avatar-small" src="{{item.userAvatar || '/assets/icons/default-avatar.png'}}" mode="aspectFill" />
                <text class="user-name-small">{{item.userName || 'ç”¨æˆ·å'}}</text>
              </view>
            </view>
            
            <!-- äº’åŠ¨ä¿¡æ¯ -->
            <view class="interaction-info">
              <text class="interaction-item">ç‚¹èµ{{item.likes}}</text>
              <text class="interaction-item">è¯„è®º{{item.comments}}</text>
              <text class="interaction-item">æ”¶è—{{item.collects}}</text>
            </view>
          </view>
        </view>
      </block>
    </view>
  </view>

  <!-- å•åˆ—å¸ƒå±€ -->
  <view class="video-list" wx:if="{{!isEmpty && layoutMode === 'single'}}">
    <view class="video-card" wx:for="{{videos}}" wx:key="id" bindtap="onVideoTap" data-index="{{index}}">
      <!-- ç”¨æˆ·ä¿¡æ¯ -->
      <view class="card-header">
        <image class="user-avatar" src="{{item.userAvatar || '/assets/icons/default-avatar.png'}}" mode="aspectFill" />
        <text class="user-name">{{item.userName || 'ç”¨æˆ·å'}}</text>
      </view>
      
      <!-- è§†é¢‘æ ‡é¢˜å’Œè¯é¢˜ -->
      <view class="card-content">
        <text class="video-hashtag">{{item.topics || ''}} {{item.title}}</text>
        <image class="video-thumbnail" src="{{item.coverUrl}}" mode="aspectFill" />
      </view>
      
      <!-- äº’åŠ¨ä¿¡æ¯ -->
      <view class="card-interaction">
        <text class="card-interaction-item">ç‚¹èµ{{item.likes}}</text>
        <text class="card-interaction-item">è¯„è®º{{item.comments}}</text>
        <text class="card-interaction-item">æ”¶è—{{item.collects}}</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{isEmpty && !loading}}">
    <!-- <image class="empty-icon" src="/assets/icons/warning.png" mode="aspectFit" /> -->
    <text class="empty-icon-text">ğŸ“¹</text>
    <text class="empty-text">æš‚æ— è§†é¢‘å†…å®¹</text>
    <view class="empty-btn" bindtap="onPublish">
      <text>å‘å¸ƒç¬¬ä¸€ä¸ªè§†é¢‘</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading && !refreshing}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- æ²¡æœ‰æ›´å¤š -->
  <view class="no-more" wx:if="{{!hasMore && videos.length > 0 && !loading}}">
    <text>æ²¡æœ‰æ›´å¤šäº†</text>
  </view>

  <!-- å‘å¸ƒæŒ‰é’® -->
  <view class="publish-fab" bindtap="onPublish">
    <image class="publish-icon" src="/assets/icons/video-btn.png" mode="aspectFit" />
    <text class="publish-text">å‘å¸ƒ</text>
  </view>

  <!-- åº•å›¾æ¨ªå¹… -->
  <page-banner pageKey="community" position="bottom"></page-banner>
</view>
