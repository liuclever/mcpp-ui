# interaction-bar 组件测试指南

## 测试方法

### 方法一：使用微信开发者工具测试（推荐）

#### 1. 添加测试页面到 app.json

在 `小程序/miniprogram/app.json` 的 `pages` 数组中添加测试页面：

```json
{
  "pages": [
    "pages/test-interaction/test-interaction",  // 添加这一行（放在第一行可以直接打开）
    "pages/product/index",
    // ... 其他页面
  ]
}
```

#### 2. 启动微信开发者工具

```powershell
# 在小程序目录下
cd 小程序
```

然后用微信开发者工具打开 `小程序` 目录。

#### 3. 测试内容

测试页面包含三个测试场景：

**场景1：横向布局测试**
- 初始状态：未点赞、未收藏
- 点击点赞按钮 → 查看动画效果 → 数字增加
- 再次点击 → 取消点赞 → 数字减少
- 点击收藏按钮 → 图标变色 → 数字增加
- 点击评论按钮 → 弹出提示
- 点击分享按钮 → 触发分享

**场景2：纵向布局测试**
- 初始状态：已点赞、已收藏
- 测试纵向排列样式
- 测试在深色背景下的显示效果
- 测试所有按钮功能

**场景3：大数字格式化测试**
- 点赞数：12345 → 显示为 12.3k
- 收藏数：6789 → 显示为 6.8k
- 测试数字格式化是否正确

#### 4. 检查项

✅ **视觉检查**
- [ ] 图标显示正常
- [ ] 数字显示正确
- [ ] 横向布局间距合理
- [ ] 纵向布局在右侧显示
- [ ] 已点赞/已收藏状态图标正确

✅ **交互检查**
- [ ] 点击点赞有弹跳动画（约0.6秒）
- [ ] 点击按钮有缩放反馈
- [ ] 状态切换流畅
- [ ] 数字实时更新

✅ **功能检查**
- [ ] 点赞/取消点赞正常
- [ ] 收藏/取消收藏正常
- [ ] 评论按钮触发事件
- [ ] 分享按钮触发事件
- [ ] 操作日志正确记录

✅ **数字格式化检查**
- [ ] 0-999：显示原数字
- [ ] 1000-9999：显示 x.xk
- [ ] 10000+：显示 x.xw

---

### 方法二：在现有页面中集成测试

如果你已经有视频相关的页面，可以直接在那里使用组件：

#### 1. 在页面 JSON 中引入组件

```json
{
  "usingComponents": {
    "interaction-bar": "/components/interaction-bar/interaction-bar"
  }
}
```

#### 2. 在页面 WXML 中使用

```xml
<interaction-bar
  videoId="{{video.id}}"
  likes="{{video.likes}}"
  collects="{{video.collects}}"
  comments="{{video.comments}}"
  shares="{{video.shares}}"
  isLiked="{{video.isLiked}}"
  isCollected="{{video.isCollected}}"
  layout="horizontal"
  bind:like="onLike"
  bind:collect="onCollect"
  bind:comment="onComment"
  bind:share="onShare"
/>
```

#### 3. 在页面 TS 中处理事件

```typescript
Page({
  onLike(e: any) {
    const { videoId, isLiked } = e.detail;
    console.log('点赞事件', videoId, isLiked);
    // 调用后端API
  },
  
  onCollect(e: any) {
    const { videoId, isCollected } = e.detail;
    console.log('收藏事件', videoId, isCollected);
    // 调用后端API
  },
  
  onComment(e: any) {
    const { videoId } = e.detail;
    console.log('评论事件', videoId);
    // 打开评论列表
  },
  
  onShare(e: any) {
    const { videoId } = e.detail;
    console.log('分享事件', videoId);
    // 触发分享
  }
});
```

---

### 方法三：使用控制台调试

在微信开发者工具中：

1. 打开调试器（F12 或点击"调试器"标签）
2. 在 Console 中输入：

```javascript
// 获取组件实例
const page = getCurrentPages()[0];
const component = page.selectComponent('.interaction-bar');

// 测试方法
component.onLikeTap();      // 触发点赞
component.onCollectTap();   // 触发收藏
component.onCommentTap();   // 触发评论
component.onShareTap();     // 触发分享
```

---

## 常见问题排查

### 1. 图标不显示

**问题**：按钮位置正确但图标不显示

**解决**：
- 检查图标路径是否正确：`/assets/icons/xxx.png`
- 确认图标文件存在于 `小程序/miniprogram/assets/icons/` 目录
- 检查图片格式是否支持（PNG、JPG）

### 2. 点击无反应

**问题**：点击按钮没有任何反应

**解决**：
- 检查是否绑定了事件：`bind:like="onLike"`
- 检查父组件是否定义了对应的事件处理函数
- 在控制台查看是否有错误信息

### 3. 动画不流畅

**问题**：点赞动画卡顿或不显示

**解决**：
- 检查是否在真机上测试（模拟器可能性能不足）
- 确认 wxss 文件中的动画定义正确
- 检查是否有其他样式冲突

### 4. 数字格式化错误

**问题**：数字显示不正确

**解决**：
- 检查传入的数字类型是否为 Number
- 在控制台打印 `formatNumber()` 方法的返回值
- 确认数字不是字符串类型

---

## 性能测试

### 1. 快速点击测试

连续快速点击点赞按钮10次，检查：
- [ ] 动画不会重叠或卡顿
- [ ] 数字更新正确
- [ ] 没有内存泄漏

### 2. 多实例测试

在一个页面中放置多个 interaction-bar 组件，检查：
- [ ] 每个组件独立工作
- [ ] 点击一个不影响其他
- [ ] 页面滚动流畅

### 3. 长时间运行测试

让页面运行30分钟，检查：
- [ ] 内存占用稳定
- [ ] 没有性能下降
- [ ] 交互依然流畅

---

## 真机测试

### iOS 测试

1. 使用微信开发者工具的"预览"功能
2. 用手机扫码打开
3. 测试所有功能
4. 特别注意动画效果

### Android 测试

1. 同样使用"预览"功能
2. 测试不同品牌手机（华为、小米、OPPO等）
3. 检查兼容性

---

## 自动化测试（可选）

如果需要编写自动化测试，可以使用小程序的测试框架：

```javascript
// test/interaction-bar.test.js
const simulate = require('miniprogram-simulate');

describe('interaction-bar', () => {
  let component;

  beforeEach(() => {
    component = simulate.render(
      simulate.load('/components/interaction-bar/interaction-bar')
    );
  });

  it('should render correctly', () => {
    expect(component.dom.innerHTML).toContain('interaction-bar');
  });

  it('should trigger like event', () => {
    const callback = jest.fn();
    component.addEventListener('like', callback);
    
    component.querySelector('.interaction-item').dispatchEvent('tap');
    
    expect(callback).toHaveBeenCalled();
  });
});
```

---

## 测试报告模板

测试完成后，可以填写以下报告：

```
# interaction-bar 组件测试报告

测试时间：2026-01-02
测试人员：[你的名字]
测试环境：微信开发者工具 / iOS / Android

## 功能测试
- [x] 点赞功能正常
- [x] 收藏功能正常
- [x] 评论功能正常
- [x] 分享功能正常
- [x] 数字格式化正确
- [x] 动画效果流畅

## 兼容性测试
- [x] 微信开发者工具
- [x] iOS 真机
- [x] Android 真机

## 性能测试
- [x] 快速点击无卡顿
- [x] 多实例正常工作
- [x] 长时间运行稳定

## 问题记录
1. [如有问题，在此记录]

## 结论
组件功能完整，性能良好，可以投入使用。
```

---

## 下一步

测试通过后，可以：

1. 将组件集成到实际的视频详情页
2. 连接后端 API 实现真实的点赞、收藏功能
3. 继续开发其他相关组件（评论列表、评论输入等）
