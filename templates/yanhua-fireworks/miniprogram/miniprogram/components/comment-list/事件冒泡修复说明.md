# 评论列表组件事件冒泡修复说明

## 问题描述
用户反馈：点击"展开1条回复"按钮时，评论弹窗会关闭。

## 问题原因
在评论弹窗的实现中，外层遮罩层使用了 `bindtap="hideCommentModal"` 来实现点击遮罩关闭弹窗的功能。但是评论列表组件内部的按钮使用的是 `bindtap`，这会导致事件冒泡到外层遮罩，触发关闭操作。

### 事件传播路径
```
展开按钮 (bindtap) 
  ↓ 事件冒泡
评论容器 (catchtap="") 
  ↓ 继续冒泡
遮罩层 (bindtap="hideCommentModal")
  ↓ 触发关闭
评论弹窗关闭 ❌
```

## 解决方案
将评论列表组件内所有交互按钮的 `bindtap` 改为 `catchtap`，阻止事件冒泡。

### 修改的按钮
1. **展开/收起按钮** - `toggleExpand`
2. **回复按钮** - `onReplyTap` (父评论和子评论)
3. **点赞按钮** - `onLikeTap` (父评论和子评论)
4. **加载更多按钮** - `onLoadMore`

## 技术说明

### bindtap vs catchtap
- **bindtap**: 绑定事件，事件会冒泡到父元素
- **catchtap**: 绑定事件，阻止事件冒泡

### 修改前
```xml
<view class="expand-btn" bindtap="toggleExpand">
  <!-- 事件会冒泡 -->
</view>
```

### 修改后
```xml
<view class="expand-btn" catchtap="toggleExpand">
  <!-- 事件不会冒泡 -->
</view>
```

## 修改文件
- `comment-list.wxml` - 评论列表组件模板

## 测试验证

### 测试步骤
1. 打开产品详情页
2. 点击评论按钮打开评论弹窗
3. 点击"展开1条回复"按钮
4. ✅ 子评论应该展开，弹窗不应该关闭
5. 点击"回复"按钮
6. ✅ 应该显示回复提示，弹窗不应该关闭
7. 点击点赞按钮
8. ✅ 应该显示点赞提示，弹窗不应该关闭
9. 点击"加载更多评论"按钮
10. ✅ 应该触发加载，弹窗不应该关闭

### 预期结果
- ✅ 所有按钮点击后，评论弹窗保持打开状态
- ✅ 只有点击遮罩层或关闭按钮时，弹窗才会关闭
- ✅ 按钮功能正常执行

## 最佳实践

### 弹窗组件的事件处理
```xml
<!-- 遮罩层：点击关闭 -->
<view class="modal" bindtap="hideModal">
  <!-- 内容容器：阻止冒泡 -->
  <view class="modal-content" catchtap="">
    <!-- 内部按钮：使用 catchtap 阻止冒泡 -->
    <button catchtap="onButtonClick">按钮</button>
  </view>
</view>
```

### 关键点
1. **遮罩层**使用 `bindtap` 监听点击关闭
2. **内容容器**使用 `catchtap=""` 阻止空点击冒泡
3. **交互按钮**使用 `catchtap` 阻止事件冒泡

## 相关文档
- [微信小程序事件系统](https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/event.html)
- [事件冒泡与捕获](https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/event.html#%E4%BA%8B%E4%BB%B6%E5%86%92%E6%B3%A1)

## 修复时间
2024-01-02

## 修复状态
✅ 已修复并测试通过
